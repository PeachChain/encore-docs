---
title: "Presenting Offers"
---

Present Encore retention offers to users at key moments in your app.

## Overview

Encore allows you to present targeted offers (free trials, discounts, credits) to users at critical moments like cancellation flows or feature paywalls. The SDK provides multiple presentation methods to fit your app's architecture.

---

## Presentation Methods

### SwiftUI: Fluent Builder API (Recommended)

The most concise and flexible way to present offers in SwiftUI - perfect for button actions:

```swift
Button("Cancel Subscription") {
    Encore.placement()
        .onCreditApplied { amount in
            print("User accepted \(amount) in credit")
            applyCreditToAccount(amount: amount)
        }
        .onDecline { reason in
            print("User declined: \(reason)")
            proceedWithCancellation()
        }
        .onNoOffersAvailable {
            proceedWithCancellation()
        }
        .onError { error in
            print("Error: \(error)")
            proceedWithCancellation()
        }
        .show()
}
```

**Why it's recommended:**
- ✅ Clean, readable callback chain
- ✅ Type-safe - no manual result switching
- ✅ Works directly in button actions
- ✅ No @State management needed
- ✅ Handles all scenarios inline

---

### SwiftUI: `.encoreSheet()` Modifier

The most declarative way to present offers using SwiftUI state:

```swift
import EncoreSDK
import SwiftUI

struct CancellationView: View {
    @State private var showEncoreOffer = false
    
    var body: some View {
        VStack {
            Text("We're sad to see you go...")
            
            Button("Cancel Subscription") {
                showEncoreOffer = true
            }
        }
        .encoreSheet(isPresented: $showEncoreOffer) { creditAmount in
            // User accepted the offer!
            print("User received \(creditAmount) in credit")
            self.applyCreditToAccount(amount: creditAmount)
        } onDecline: { reason in
            // User declined the offer
            switch reason {
            case .userCancelled:
                print("User dismissed the offer")
            case .userDeclinedOffer:
                print("User explicitly declined")
            }
            self.proceedWithCancellation()
        } onNoOffersAvailable: {
            // No offers configured for this user
            self.proceedWithCancellation()
        } onError: { error in
            // Handle errors gracefully
            print("Error: \(error)")
            self.proceedWithCancellation()
        }
    }
}
```

---

### UIKit: Imperative Presentation

For UIKit apps or when you need programmatic control:

```swift
import EncoreSDK

class CancellationViewController: UIViewController {
    
    @IBAction func cancelButtonTapped(_ sender: UIButton) {
        // Present Encore offer
        Encore.shared.presentOffer(from: self) { result in
            switch result {
            case .success(let presentationResult):
                switch presentationResult {
                case .creditApplied(let amount):
                    print("User accepted \(amount) in credit!")
                    self.applyCreditToAccount(amount: amount)
                    
                case .declined(let reason):
                    print("User declined: \(reason)")
                    self.proceedWithCancellation()
                    
                case .noOffersAvailable:
                    print("No offers available for this user")
                    self.proceedWithCancellation()
                }
                
            case .failure(let error):
                print("Error presenting offer: \(error)")
                self.proceedWithCancellation()
            }
        }
    }
}
```

---

### SwiftUI: Async/Await

For when you need to await the result in Swift concurrency:

```swift
Button("Cancel Subscription") {
    Task {
        do {
            let result = try await Encore.shared.show()
            
            switch result {
            case .creditApplied(let amount):
                print("User accepted \(amount) in credit!")
                
            case .declined(let reason):
                print("User declined: \(reason)")
                
            case .noOffersAvailable:
                print("No offers available")
            }
        } catch {
            print("Error: \(error)")
        }
    }
}
```

**Note:** The fluent builder API is usually more concise (see above).

---

## When to Present Offers

### ✅ Recommended Moments

1. **Cancellation Flows** - User is about to cancel subscription
2. **Feature Paywalls** - User hits a premium feature without access
3. **Trial Expiration** - User's trial is ending soon
4. **Downgrade Attempts** - User tries to move to a lower tier
5. **Churn Signals** - Decreased engagement or usage

### ❌ Avoid

- **App Launch** - Too early, user hasn't engaged yet
- **Onboarding** - Focus on core value first
- **Mid-Task** - Don't interrupt active workflows
- **After Purchase** - User already committed

---

## Handling Results

### Credit Applied

When a user accepts an offer, you receive the credit amount to apply:

```swift
.onCreditApplied { amount in
    // Apply credit to user's account
    AccountManager.shared.addCredit(amount: amount)
    
    // Show confirmation
    showToast("You've received \(amount) in credit!")
    
    // Update UI to reflect new balance
    refreshAccountBalance()
}
```

### User Declined

Handle gracefully when users decline:

```swift
.onDecline { reason in
    switch reason {
    case .userCancelled:
        // User dismissed without interacting
        analytics.track("offer_dismissed")
        
    case .userDeclinedOffer:
        // User explicitly declined the offer
        analytics.track("offer_declined")
        proceedWithOriginalAction()
    }
}
```

### No Offers Available

This happens when:
- No campaigns are configured in the dashboard
- User doesn't match any audience filters
- User already has active entitlements

```swift
.onNoOffersAvailable {
    // Proceed with original flow
    proceedWithCancellation()
}
```

### Error Handling

Always handle errors gracefully:

```swift
.onError { error in
    switch error {
    case .networkError:
        // No internet connection
        showRetryDialog()
        
    case .configurationError:
        // SDK not configured properly
        print("Check API key configuration")
        
    case .noOfferAvailable:
        // No offers to show
        proceedWithOriginalAction()
        
    default:
        // Unknown error
        print("Error: \(error)")
        proceedWithOriginalAction()
    }
}
```

---

## Setting User Context

Before presenting offers, set user attributes for better targeting:

```swift
// Set attributes before showing offer
Encore.shared.setUserAttributes([
    "email": "user@example.com",
    "subscriptionTier": "premium",
    "monthsSubscribed": "6",
    "cancelReason": "too_expensive"
])

// Then present the offer
Encore.placement()
    .onCreditApplied { amount in
        // Handle acceptance
    }
    .show()
```

This allows the dashboard to show personalized offers based on user context.

---

## Best Practices

### 1. Always Handle All Callbacks

```swift
// ✅ Good - Handle all scenarios
.encoreSheet(isPresented: $showOffer) { amount in
    // Credit applied
} onDecline: { reason in
    // User declined
} onNoOffersAvailable: {
    // No offers
} onError: { error in
    // Error occurred
}

// ❌ Bad - Missing error handling
.encoreSheet(isPresented: $showOffer) { amount in
    // Only handling success
}
```

### 2. Don't Block Core Functionality

```swift
// ✅ Good - Always allow user to proceed
Button("Cancel Subscription") {
    showEncoreOffer = true
}
.encoreSheet(isPresented: $showEncoreOffer) { amount in
    applyCredit(amount)
} onDecline: { _ in
    proceedWithCancellation() // Let user cancel
}

// ❌ Bad - Forcing user to see offer
Button("Cancel Subscription") {
    // No way to skip offer
    showEncoreOffer = true
}
```

### 3. Track Analytics

```swift
.onCreditApplied { amount in
    analytics.track("encore_offer_accepted", [
        "amount": amount,
        "context": "cancellation_flow"
    ])
}
.onDecline { reason in
    analytics.track("encore_offer_declined", [
        "reason": "\(reason)",
        "context": "cancellation_flow"
    ])
}
```

### 4. Provide Visual Feedback

```swift
@State private var isLoadingOffer = false

Button("Cancel Subscription") {
    isLoadingOffer = true
    showEncoreOffer = true
}
.encoreSheet(isPresented: $showEncoreOffer) { amount in
    isLoadingOffer = false
    // Handle success
} onDecline: { _ in
    isLoadingOffer = false
    // Handle decline
}
.overlay {
    if isLoadingOffer {
        ProgressView()
    }
}
```

---

## Next Steps

- [Tracking Entitlements State](./tracking-entitlements.mdx) - Monitor what entitlements users have
- [Setting User Attributes](./setting-user-attributes.mdx) - Personalize offers with user data
- [Error Handling](./error-handling.mdx) - Comprehensive error handling guide
