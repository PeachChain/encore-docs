---
title: "User Management"
---
Identifying users, setting attributes, and managing identity in your iOS app.

---

## Overview

Encore requires user identification to track entitlements and prevent abuse across devices. You can also set user attributes to enable targeted offers and personalization.

---

## Anonymous Users

Encore **automatically generates** a random user ID that persists until the user deletes/reinstalls your app or calls `reset()`.

This anonymous ID is stored securely and allows entitlement tracking to work immediately without requiring explicit user identification. The auto-generated ID is a standard UUID (e.g., `550e8400-e29b-41d4-a716-446655440000`).

You can call `Encore.shared.reset()` to reset this ID and clear any entitlement data.

---

## Identified Users

If you use your own user management system, call `identify(userId:)` when you have a user's identity:

```swift
// After retrieving a user's ID from login or account creation
Encore.shared.identify(userId: user.id)
```

This enables the SDK to:
- Associate promotional access with your user account
- Sync entitlements across devices when the user logs in
- Track conversion attribution accurately


---

## Resetting User Identity

When a user logs out, call `reset()`:

```swift
// When the user signs out
Encore.shared.reset()
```

This will:
- Reset the user ID to a new auto-generated anonymous ID
- Clear cached entitlement data
- Clear all user attributes

---

## Setting User Attributes

User attributes enable:
- **Personalized offers** based on user data (subscription tier, usage, etc.)
- **Audience targeting** with specific offers in the Encore dashboard
- **Conversion context tracking** for analytics

### Basic Usage

Set attributes using a simple dictionary of string key-value pairs:

```swift
Encore.shared.setUserAttributes([
    "email": "user@example.com",
    "subscriptionTier": "premium",
    "monthsSubscribed": "6",
    "cancelReason": "too_expensive"
])
```

You can also set user attributes when identifying:

```swift
Encore.shared.identify(
    userId: "user_12345",
    attributes: [
        "email": "user@example.com",
        "subscriptionTier": "premium",
        "monthsSubscribed": "6"
    ]
)
```

**Important:** `setUserAttributes()` **merges** with existing attributes - it does not replace them.

### Before Presenting Offers

Set attributes before showing offers for better targeting:

```swift
// Set cancellation context
Encore.shared.setUserAttributes([
    "cancelReason": "too_expensive",
    "monthsSubscribed": "6"
])

// Then present the offer
Encore.placement()
    .onResult { result in
        switch result {
        case .success(.granted(let entitlement)):
            print("Granted: \(entitlement)")
            return
        case .success(.rejected), .failure:
            break
        }
        proceedWithCancellation()
    }
    .show()
```

This allows the dashboard to show personalized offers based on user context.

---

## Implementation Examples

### SwiftUI with Login

```swift
import SwiftUI
import Encore

@main
struct YourApp: App {
    @StateObject private var authManager = AuthManager()

    init() {
        Encore.shared.configure(apiKey: "pk_your_api_key")
    }

    var body: some Scene {
        WindowGroup {
            MainAppView()
                .onAppear {
                    if authManager.isAuthenticated {
                        Encore.shared.identify(
                            userId: authManager.userId,
                            attributes: [
                                "email": authManager.email,
                                "subscriptionTier": authManager.tier
                            ]
                        )
                    }
                }
        }
    }
}

struct SettingsView: View {
    @EnvironmentObject var authManager: AuthManager
    
    var body: some View {
        Button("Log Out") {
            Encore.shared.reset()
            authManager.logout()
        }
    }
}
```

### UIKit with Login

```swift
class LoginViewController: UIViewController {
    func handleSuccessfulLogin(user: User) {
        Encore.shared.identify(
            userId: user.id,
            attributes: [
                "email": user.email,
                "subscriptionTier": user.subscriptionTier
            ]
        )
        navigateToMainApp()
    }
}

class SettingsViewController: UIViewController {
    func handleLogout() {
        Encore.shared.reset()
        authManager.logout()
        navigateToLogin()
    }
}
```

### Apps Without Login

If your app doesn't require users to log in, you don't need to do anything special:

```swift
@main
struct YourApp: App {
    init() {
        Encore.shared.configure(apiKey: "pk_your_api_key")
        // That's it! The SDK uses an anonymous ID automatically
    }
    
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}

// You can still set attributes for anonymous users
Button("Cancel Subscription") {
    Encore.shared.setUserAttributes([
        "cancelReason": "too_expensive"
    ])
    Encore.placement().show()
}
```

---

## Common Attribute Use Cases

### Cancellation Flow

```swift
Button("Cancel Subscription") {
    Encore.shared.setUserAttributes([
        "cancelReason": "too_expensive",
        "monthsSubscribed": "6"
    ])
    Encore.placement().show()
}
```

### Feature Paywall

```swift
func showPremiumFeature() {
    Encore.shared.setUserAttributes([
        "featureRequested": "advanced_analytics",
        "usageLevel": "power_user"
    ])
    Encore.placement().show()
}
```

### User Profile Updates

```swift
func updateUserProfile() {
    guard let user = currentUser else { return }
    
    Encore.shared.setUserAttributes([
        "email": user.email,
        "subscriptionTier": user.tier,
        "monthsSubscribed": "\(user.monthsSubscribed)"
    ])
}
```

---

## Verification

After configuring the SDK, you should see this in your console:

```
âœ… [Encore] EntitlementManager initialized for hybrid entitlement tracking
ðŸ†” [ENTITLEMENTS] Generated new anonymous user ID
```

If you call `identify()` with a specific user ID, you'll see:

```
ðŸ”„ [ENTITLEMENTS] REFRESH UserId changed from '550e8400-...' to 'user_abc123' - refreshing
```

These messages confirm user identification is working correctly! âœ…

---

## Next Steps

- [Presenting Offers](./presenting-offers.mdx) - Show promotional offers to your users
- [Tracking Entitlements](./tracking-entitlements.mdx) - Learn how to check user entitlements
