---
title: "Tracking Entitlements"
---

Monitor promotional rewards and temporary access in real-time to adapt your UI and user experience.

## Overview

Encore tracks earned entitlements automatically, including free trials, discounts, and credits. You can check entitlement status anywhere in your app to display promotional badges, show reward status, or highlight temporary access periods.

---

## Entitlement Types

Encore supports three types of promotional rewards:

- **`.freeTrial()`** - Time-limited promotional access (e.g., "7-day trial")
- **`.discount()`** - Percentage or dollar-based subscription discounts
- **`.credit()`** - Account credits that can be applied to purchases

---

## Entitlement Scopes

When checking entitlements, you can specify which scope to use:

### `.verified` 

Only counts entitlements that have been verified (user completed the conversion action):

```swift
let hasActiveTrial = Encore.shared.isActive(.freeTrial(), in: .verified)
// Returns true only if user completed the conversion
```

### `.all`

Counts both verified AND provisional entitlements. Useful for optimistic UI updates for better UX:

```swift
let hasActiveTrial = Encore.shared.isActive(.freeTrial(), in: .all)
// Returns true even if user hasn't converted yet
```

---

## Using with Your Entitlement Manager

The most common pattern is to integrate Encore promotional rewards with your existing subscription/entitlement manager. This keeps your access logic centralized and combines IAP subscriptions with Encore promotional rewards.

### Basic Setup

Create a centralized manager that tracks both IAP subscriptions and Encore promotional rewards:

```swift
import Foundation
import Encore
import Combine

@Observable
class EntitlementManager {
    var hasProAccess: Bool = false
    private var cancellables = Set<AnyCancellable>()
    
    init() {
        // Combine IAP subscription status with Encore promotional rewards
        Publishers.CombineLatest(
            yourIAPManager.subscriptionStatusPublisher,
            Encore.shared.isActivePublisher(for: .freeTrial(), in: .verified)
        )
        .map { iapActive, encoreActive in
            // User has pro access if EITHER they have an active IAP subscription
            // OR they have an active Encore promotional reward
            return iapActive || encoreActive
        }
        .assign(to: \.hasProAccess, on: self)
        .store(in: &cancellables)
    }
}
```

### Usage in SwiftUI

Once your entitlement manager is set up, use it throughout your app:

```swift
import SwiftUI

@main
struct YourApp: App {
    @StateObject private var entitlements = EntitlementManager()
    
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(entitlements)
        }
    }
}

struct ContentView: View {
    @EnvironmentObject var entitlements: EntitlementManager
    
    var body: some View {
        VStack {
            if entitlements.hasProAccess {
                // Show premium content
                PremiumContentView()
            } else {
                // Show paywall
                SubscriptionPaywallView()
            }
        }
    }
}
```

---

## Checking Entitlement Status

### Simple Boolean Check

The easiest way to check if a user has an active promotional reward:

```swift
import Encore

// Check for active free trial (verified only)
let hasVerifiedTrial = Encore.shared.isActive(.freeTrial(), in: .verified)

// Check for any active trial (verified or provisional)
let hasAnyTrial = Encore.shared.isActive(.freeTrial(), in: .all)
```

### Using Combine Publishers

For reactive apps, subscribe to entitlement changes:

```swift
import Combine
import Encore

class RewardManager: ObservableObject {
    @Published var hasActiveReward = false
    private var cancellables = Set<AnyCancellable>()
    
    init() {
        // Subscribe to promotional access changes
        Encore.shared.isActivePublisher(for: .freeTrial(), in: .verified)
            .assign(to: \.hasActiveReward, on: self)
            .store(in: &cancellables)
    }
}
```

### Using Delegate Pattern

For UIKit apps or non-Combine architectures:

```swift
import Encore

class SubscriptionManager: EncoreDelegate {
    var hasPromotionalAccess = false
    
    init() {
        // Set delegate
        Encore.shared.entitlementsDelegate = self
        
        // Initial check
        hasPromotionalAccess = Encore.shared.isActive(.freeTrial(), in: .verified)
    }
    
    // Delegate method called when entitlements change
    func encoreDidChangeEntitlement(
        _ isActive: Bool,
        for type: EntitlementType,
        in scope: EntitlementScope
    ) {
        if type == .freeTrial && scope == .verified {
            hasPromotionalAccess = isActive
            
            // Update UI or notify observers
            NotificationCenter.default.post(
                name: .promotionalAccessChanged,
                object: nil,
                userInfo: ["hasAccess": isActive]
            )
        }
    }
}
```

---

## Common Patterns

### Promotional Badge Display

Show reward status in your UI:

```swift
struct ProfileView: View {
    @State private var rewardStatus: String = "Standard"
    
    var body: some View {
        VStack {
            Text("Account Status: \(rewardStatus)")
                .font(.headline)
        }
        .onAppear {
            updateStatus()
        }
        .onReceive(
            Encore.shared.isActivePublisher(for: .freeTrial(), in: .verified)
        ) { _ in
            updateStatus()
        }
    }
    
    private func updateStatus() {
        if Encore.shared.isActive(.freeTrial(), in: .verified) {
            rewardStatus = "Free Trial Active üéâ"
        } else if Encore.shared.isActive(.discount(), in: .verified) {
            rewardStatus = "Discount Available"
        } else {
            rewardStatus = "Standard"
        }
    }
}
```

---

## Third-Party Paywall Integrations

If you're using third-party paywall providers like Superwall or RevenueCat, you can combine their subscription status with Encore promotional rewards in your entitlement manager.

<Accordion title="Superwall Integration">

To track both Superwall subscriptions and Encore rewards, add `Superwall.shared.subscriptionStatus` to your `Publishers.CombineLatest`:

```swift
import Foundation
import Encore
import Combine
import SuperwallKit

@Observable
class EntitlementManager {
    var hasProAccess: Bool = false
    private var cancellables = Set<AnyCancellable>()
    
    init() {
        // Combine Superwall subscription status with Encore promotional rewards
        Publishers.CombineLatest3(
            Superwall.shared.subscriptionStatus,
            Encore.shared.isActivePublisher(for: .freeTrial(), in: .verified),
            yourIAPManager.subscriptionStatusPublisher  // Optional: your own IAP manager
        )
        .map { superwallActive, encoreActive, iapActive in
            // User has pro access if they have an active subscription from ANY source
            return superwallActive == .active || encoreActive || iapActive
        }
        .assign(to: \.hasProAccess, on: self)
        .store(in: &cancellables)
    }
}
```

The `superwallActive` variable represents the Superwall subscription status and should be checked against `.active`.

</Accordion>

<Accordion title="RevenueCat Integration">

To track both RevenueCat subscriptions and Encore rewards, create a publisher for RevenueCat's customer info and add it to your `Publishers.CombineLatest`:

```swift
import Foundation
import Encore
import Combine
import RevenueCat

@Observable
class EntitlementManager {
    var hasProAccess: Bool = false
    private var cancellables = Set<AnyCancellable>()
    private let revenueCatStatusSubject = CurrentValueSubject<Bool, Never>(false)
    
    init() {
        setupRevenueCatListener()
        
        // Combine RevenueCat subscription status with Encore promotional rewards
        Publishers.CombineLatest3(
            revenueCatStatusSubject.eraseToAnyPublisher(),
            Encore.shared.isActivePublisher(for: .freeTrial(), in: .verified),
            yourIAPManager.subscriptionStatusPublisher 

        )
        .map { revenueCatActive, encoreActive, iapActive in
            // User has pro access if they have an active subscription from ANY source
            return revenueCatActive || encoreActive || iapActive
        }
        .assign(to: \.hasProAccess, on: self)
        .store(in: &cancellables)
    }
    
    private func setupRevenueCatListener() {
        // Listen for RevenueCat customer info updates
        Purchases.shared.getCustomerInfo { [weak self] customerInfo, error in
            if let customerInfo = customerInfo {
                // Check if user has any active entitlements
                let hasActiveEntitlement = !customerInfo.entitlements.active.isEmpty
                self?.revenueCatStatusSubject.send(hasActiveEntitlement)
            }
        }
    }
}
```

The RevenueCat status is determined by checking if `customerInfo.entitlements.active` is not empty, which indicates the user has at least one active entitlement.

> **üí° Tip:** You can also implement `PurchasesDelegate` protocol to receive automatic updates when customer info changes, ensuring your entitlement status stays in sync.

</Accordion>

---

## Best Practices

### ‚úÖ DO

```swift
// ‚úÖ Subscribe to changes for reactive UI
.onReceive(Encore.shared.isActivePublisher(for: .freeTrial(), in: .verified)) { isActive in
    self.hasReward = isActive
}

// ‚úÖ Check on appear for initial state
.onAppear {
    hasReward = Encore.shared.isActive(.freeTrial(), in: .verified)
}

// ‚úÖ Combine with IAP subscription status
let hasAccess = hasIAPSubscription || hasEncoreReward
```

### ‚ùå DON'T

```swift
// ‚ùå Don't cache status without updates
let hasReward = Encore.shared.isActive(.freeTrial(), in: .verified)
// This value becomes stale - use publisher instead
```

---

## Next Steps

- [Presenting Offers](./present-offers.mdx) - Show retention offers to users
- [User Management](./user-management.mdx) - Identify users, set attributes, and manage sessions
- [SuperWall Integration](./superwall-integration.mdx) - Integrate with SuperWall for dynamic paywalls
- [RevenueCat Integration](./revenuecat-integration.mdx) - Integrate with RevenueCat for subscription management
